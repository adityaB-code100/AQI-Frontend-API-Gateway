<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>üåç Hyperlocal AQI ‚Äì Village 7-Day Forecast</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    a.btn-nav {
      position: relative;
      z-index: 10;
      cursor: pointer;
    }
    
    /* Active state styling for nav items */
    .nav-item a.active {
      background-color: rgb(224 231 255); /* indigo-100 */
      color: rgb(67 56 202); /* indigo-800 */
    }
    
    .dark .nav-item a.active {
      background-color: rgb(67 56 202); /* indigo-900 */
      color: rgb(224 231 255); /* indigo-100 */
    }
    
    /* Mobile menu active state */
    .mobile-menu a.active {
      background-color: rgb(224 231 255);
      color: rgb(67 56 202);
    }
    
    .dark .mobile-menu a.active {
      background-color: rgb(67 56 202);
      color: rgb(224 231 255);
    }
  </style>
  
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
  
  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 text-gray-900 font-sans pt-16 theme-transition dark:bg-gray-900 dark:text-gray-100">
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loader"></div>
    <p class="text-white mt-4 text-lg font-medium">Loading Hyperlocal AQI Data...</p>
  </div>

  <!-- Navigation Bar -->
  <nav class="navbar fixed top-0 left-0 right-0 z-50 bg-white bg-opacity-95 backdrop-blur-sm shadow-md py-3 px-4 dark:bg-gray-800 dark:bg-opacity-95">
    <div class="container mx-auto flex items-center justify-between">
      <a class="navbar-brand flex items-center gap-2 font-bold text-indigo-600 text-xl dark:text-indigo-400" href="/">
        <i class="fas fa-globe-asia animate-float"></i> Hyperlocal AQI
      </a>
      
      <div class="flex items-center gap-4">
        <button id="themeToggle" class="p-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700">
          <i class="fas fa-moon" id="themeIcon"></i>
        </button>
        
        <!-- Mobile menu button -->
        <button class="navbar-toggler md:hidden block text-gray-700 dark:text-gray-300" type="button" id="mobileMenuButton">
          <span class="block w-6 h-0.5 bg-current mb-1 transition-transform"></span>
          <span class="block w-6 h-0.5 bg-current mb-1 transition-transform"></span>
          <span class="block w-6 h-0.5 bg-current transition-transform"></span>
        </button>
        
        <div class="hidden md:flex items-center">
          <ul class="navbar-nav flex space-x-2 mr-6">
            <li class="nav-item">
              <a class="nav-link px-4 py-2 rounded-lg font-medium text-gray-700  hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700  {% if request.endpoint == 'dashboard' %}active{% endif %}" href="/">
                <i class="fas fa-home mr-1"></i> Home
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link px-4 py-2 rounded-lg font-medium text-gray-700  hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700  {% if request.endpoint == 'dashboard' %}active{% endif %}" href="/compare">
                <i class="fas fa-balance-scale mr-1"></i> Compare
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link px-4 py-2 rounded-lg font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700 {% if request.endpoint == 'about' %}active{% endif %}" href="/about">
                <i class="fas fa-info-circle mr-1"></i> About
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link px-4 py-2 rounded-lg font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700 {% if request.endpoint == 'coverage' %}active{% endif %}" href="/coverage">
                <i class="fas fa-map-marked-alt mr-1"></i> Coverage
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link px-4 py-2 rounded-lg font-medium text-gray-700 hover:bg-gray-100 transition-colors dark:text-gray-300 dark:hover:bg-gray-700 {% if request.endpoint == 'profile' %}active{% endif %}" href="/profile">
                <i class="fas fa-id-card mr-1"></i> Profile
              </a>
            </li>
          </ul>
          <div class="flex items-center gap-2">
            {% if session.get('user') or session.get('institution') %}
              <!-- If user is logged in -->
              <a href="/logout"
                class="flex-1 btn-nav px-4 py-2 rounded-lg font-medium border border-red-600 text-red-600 hover:bg-red-600 hover:text-white transition-colors dark:border-red-400 dark:text-red-400 dark:hover:bg-red-400 dark:hover:text-white">
                Logout
              </a>
            {% else %}
              <!-- If user is NOT logged in -->
              <a href="/login"
                class="flex-1 btn-nav px-4 py-2 rounded-lg font-medium border border-indigo-600 text-indigo-600 hover:bg-indigo-600 hover:text-white transition-colors dark:border-indigo-400 dark:text-indigo-400 dark:hover:bg-indigo-400 dark:hover:text-white">
                Login
              </a>
              <a href="{{ url_for('register') }}"
                class="flex-1 btn-nav px-4 py-2 rounded-lg font-medium bg-gradient-to-r from-indigo-600 to-indigo-500 text-white hover:shadow-lg transform hover:-translate-y-0.5 transition-all dark:from-indigo-500 dark:to-indigo-400">
                Register
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    
    <div class="mobile-menu hidden md:hidden bg-white mt-4 rounded-lg shadow-lg p-4 dark:bg-gray-800" id="mobileMenu">
      <ul class="space-y-2">
        <li>
          <a class="block px-4 py-2 rounded-lg font-medium {% if request.endpoint == 'dashboard' %}active{% endif %}" href="/">
            <i class="fas fa-home mr-2"></i> Home
          </a>
        </li>
        <li>
          <a class="block px-4 py-2 rounded-lg font-medium {% if request.endpoint == 'about' %}active{% endif %}" href="/about">
            <i class="fas fa-info-circle mr-2"></i> About
          </a>
        </li>

         <li>
          <a class="block px-4 py-2 rounded-lg font-medium {% if request.endpoint == 'compare' %}active{% endif %}" href="/compare">
            <i class="fas fa-balance-scale mr-1"></i> Compare
          </a>
        </li>
        <li>
          <a class="block px-4 py-2 rounded-lg font-medium {% if request.endpoint == 'coverage' %}active{% endif %}" href="/coverage">
            <i class="fas fa-map-marked-alt mr-2"></i> Coverage
          </a>
        </li>
        <li>
          <a class="block px-4 py-2 rounded-lg font-medium {% if request.endpoint == 'profile' %}active{% endif %}" href="/profile">
            <i class="fas fa-id-card mr-2"></i> Profile
          </a>
        </li>
      </ul>
    </div>
  </nav>

  {% block content %}
  {% endblock %}

  <!-- FOOTER -->
  <footer class="bg-gray-100 text-gray-600 text-center py-6  dark:bg-gray-800 dark:text-gray-400">
    <p>¬© 2025 Hyperlocal AQI Forecast. Built for research & awareness.</p>
    <p>This AQI prediction system is developed for academic purposes only. Predictions are based on past data and may not represent real-time air quality. Do not rely on this system for health or safety decisions.</p>

    <div class="mt-2 flex justify-center space-x-4">
      <a href="#" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors"><i class="fab fa-twitter"></i></a>
      <a href="#" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors"><i class="fab fa-facebook"></i></a>
      <a href="#" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors"><i class="fab fa-linkedin"></i></a>
      <a href="#" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors"><i class="fab fa-github"></i></a>
    </div>
  </footer>

  <!-- Alert Container -->
  <div class="alert-container fixed top-24 right-5 z-50 max-w-xs" id="alertContainer">
    <!-- Alerts will be inserted here by JavaScript -->
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Hide loading screen
      setTimeout(() => {
        document.getElementById('loadingScreen').style.opacity = '0.2';
        setTimeout(() => {
          document.getElementById('loadingScreen').style.display = 'none';
        }, 50);
      }, 50);

      // Animate AQI values after load
      setTimeout(() => {
        document.querySelectorAll('.aqi-value, .forecast-day p').forEach(el => {
          el.style.opacity = 0;
          setTimeout(() => {
            el.style.transition = 'opacity 0.8s ease';
            el.style.opacity = 1;
          }, 300);
        });
      }, 800);

      // ‚úÖ Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobileMenuButton');
      const mobileMenu = document.getElementById('mobileMenu');
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');

          // Animate hamburger spans
          const spans = mobileMenuButton.querySelectorAll('span');
          if (mobileMenu.classList.contains('hidden')) {
            spans[0].style.transform = 'none';
            spans[1].style.opacity = '1';
            spans[2].style.transform = 'none';
          } else {
            spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
            spans[1].style.opacity = '0';
            spans[2].style.transform = 'rotate(-45deg) translate(5px, -5px)';
          }
        });
      }

      // ‚úÖ Theme toggle
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      if (themeToggle && themeIcon) {
        themeToggle.addEventListener('click', () => {
          if (document.documentElement.classList.contains('dark')) {
            document.documentElement.classList.remove('dark');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
            localStorage.setItem('theme', 'light');
          } else {
            document.documentElement.classList.add('dark');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
            localStorage.setItem('theme', 'dark');
          }
        });

        // Apply saved theme
        if (localStorage.getItem('theme') === 'dark') {
          document.documentElement.classList.add('dark');
          themeIcon.classList.remove('fa-moon');
          themeIcon.classList.add('fa-sun');
        }
      }

      // ‚úÖ Apply button interaction
      const applyBtn = document.querySelector('.btn-primary');
      if (applyBtn) {
       applyBtn.addEventListener('click', function() {
          this.classList.add('animate-pulse');
          setTimeout(() => this.classList.remove('animate-pulse'), 2000);

          document.querySelectorAll('.aqi-value, .forecast-day p, table td').forEach(el => {
            el.style.opacity = 0.3;
            setTimeout(() => {
              el.style.transition = 'opacity 0.8s ease';
              el.style.opacity = 1;
            }, 800);
          });

          showAlert('Data updated for selected village', 'success');
        });
      }

      // ‚úÖ Simple alert system
      function showAlert(message, type) {
        const alertContainer = document.getElementById('alertContainer');
        const alert = document.createElement('div');
        alert.className = `alert-notification alert-${type} p-4 mb-4 rounded-xl text-white flex items-center animate-slideInRight`;

        let icon = 'info-circle';
        if(type === 'success') icon = 'check-circle';
        if(type === 'error') icon = 'exclamation-circle';
        if(type === 'warning') icon = 'exclamation-triangle';

        alert.innerHTML = `<i class="fas fa-${icon} mr-3 text-xl"></i> ${message}`;
        alertContainer.appendChild(alert);

        setTimeout(() => {
          alert.classList.add('opacity-0');
          setTimeout(() => alert.remove(), 500);
        }, 4000);
      }
      
      // Highlight current page in navigation
      function highlightCurrentPage() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.nav-link, .mobile-menu a');
        
        navLinks.forEach(link => {
          const href = link.getAttribute('href');
          // Check if the link's href matches the current path
          if (href === currentPath || 
              (currentPath === '/' && href === '/') ||
              (currentPath.startsWith(href) && href !== '/')) {
            link.classList.add('active');
          } else {
            link.classList.remove('active');
          }
        });
      }
      
      // Call the function to highlight current page
      highlightCurrentPage();
    });
  </script>

  <!-- Bootstrap JS (needed for modal) -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
  <script>
    const dateInput = document.getElementById("date");

// Get today's date
const today = new Date();

// Format for input[type=date] (YYYY-MM-DD)
const isoToday = today.toISOString().split("T")[0];

// Calculate date after 7 days
const next7 = new Date();
next7.setDate(today.getDate() + 7);
const isoNext7 = next7.toISOString().split("T")[0];

// Restrict calendar selection
dateInput.setAttribute("min", isoToday);   // today
dateInput.setAttribute("max", isoNext7);   // up to 7 days ahead

// Custom display format: DD-MM-YY
const formattedDate = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear().toString().slice(-2)}`;
console.log("Custom Format:", formattedDate);

// Show picked date in DD-MM-YY
dateInput.addEventListener("change", function () {
  const picked = new Date(this.value);
  if (!isNaN(picked)) {
    const custom = `${picked.getDate()}-${picked.getMonth() + 1}-${picked.getFullYear().toString().slice(-2)}`;
    console.log("You selected:", custom);
    // alert("You selected: " + custom); // optional
  }
});

  </script>

  <script>
  function validateForm() {
    const village = document.getElementById("village").value;
    const date = document.getElementById("date").value;

    if (!village || !date) {
      alert("Please select both village and date.");
      return false;
    }
    return true;
  }
</script>

<script>
  const personalBtn = document.getElementById("personal");
  const instituteBtn = document.getElementById("institution");
  const personalForm = document.getElementById("personalForm");
  const instituteForm = document.getElementById("instituteForm");

  personalBtn.addEventListener("click", () => {
    personalBtn.classList.add("active");
    instituteBtn.classList.remove("active");
    personalForm.classList.remove("hidden");
    instituteForm.classList.add("hidden");
  });

  instituteBtn.addEventListener("click", () => {
    instituteBtn.classList.add("active");
    personalBtn.classList.remove("active");
    instituteForm.classList.remove("hidden");
    personalForm.classList.add("hidden");
  });

  // Close button functionality
  document.querySelector('.close-btn').addEventListener('click', function() {
    window.history.back();
  });

  // Custom validation
  function validateForm(e, type) {
    e.preventDefault();
    let valid = true;

    if (type === "personal") {
      const name = document.getElementById("firstName").value.trim();
      const email = document.getElementById("email").value.trim();
      const number = document.getElementById("number").value.trim();
      const village = document.getElementById("village").value;
      const disease = document.getElementById("disease").value;
      const age = document.getElementById("age").value.trim();
      const pw = document.getElementById("personalPassword").value;
      const pwc = document.getElementById("personalPwConfirm").value;
      const agree = document.getElementById("personalAgree").checked;

      if (!name || !email || !number || !village || !disease || !age || !pw || !pwc) {
        alert("Please fill in all fields.");
        valid = false;
      } else if (pw !== pwc) {
        alert("Passwords do not match.");
        valid = false;
      } else if (!agree) {
        alert("You must agree to the Terms and Conditions.");
        valid = false;
      }
    } else {
      const instName = document.getElementById("instName").value.trim();
      const instEmail = document.getElementById("instEmail").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const address = document.getElementById("address").value.trim();
      const pw = document.getElementById("instPassword").value;
      const pwc = document.getElementById("instPwConfirm").value;
      const agree = document.getElementById("instAgree").checked;

      if (!instName || !instEmail || !contact || !address || !pw || !pwc) {
        alert("Please fill in all fields.");
        valid = false;
      } else if (pw !== pwc) {
        alert("Passwords do not match.");
        valid = false;
      } else if (!agree) {
        alert("You must agree to the Terms and Conditions.");
        valid = false;
      }
    }
    if (valid) e.target.submit();
  }

  personalForm.addEventListener("submit", (e) => validateForm(e, "personal"));
  instituteForm.addEventListener("submit", (e) => validateForm(e, "institute"));
</script>

  <!-- Your custom script -->
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>